
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Tutorial &#8212; Striptease 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API documentation" href="API.html" />
    <link rel="prev" title="Authentication" href="authentication.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>(Before reading this part, be sure to follow the instructions in the
page <a class="reference internal" href="authentication.html#authentication"><span class="std std-ref">Authentication</span></a>, otherwise the commands in this page will
not work.)</p>
<p>In this tutorial, we will show how to connect to the Strip webserver
and run simple commands that drive the electronics and the instrument.</p>
<div class="section" id="establising-a-connection-with-the-server">
<h2>Establising a connection with the server<a class="headerlink" href="#establising-a-connection-with-the-server" title="Permalink to this headline">¶</a></h2>
<p>The Python interface provided by Striptease revolves around the object
<a class="reference internal" href="API.html#striptease.StripConnection" title="striptease.StripConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">striptease.StripConnection</span></code></a>, which derives from
<code class="xref py py-class docutils literal notranslate"><span class="pre">web.rest.base.Connection</span></code>. It handles authentication, measure
unit conversion, and validation of commands. If you properly
configured the credentials in file <code class="docutils literal notranslate"><span class="pre">~/.strip/conf.json</span></code> (see the
page <a class="reference internal" href="authentication.html#authentication"><span class="std std-ref">Authentication</span></a>), you can create a new object with no
parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">striptease</span> <span class="k">as</span> <span class="nn">st</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">StripConnection</span><span class="p">()</span>
</pre></div>
</div>
<p>These commands create a connection but do not authenticate, as shown
by the <code class="xref py py-meth docutils literal notranslate"><span class="pre">web.rest.base.Connection.is_connected()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>To disconnect, you must call the method
<code class="xref py py-meth docutils literal notranslate"><span class="pre">web.rest.base.StripConnection.logout()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>  <span class="c1"># Log back in</span>
</pre></div>
</div>
<p>Using the <cite>login</cite> and <cite>logout</cite> commands is handy when running a REPL;
if you are writing automatic script, it’s better to rely to the fact
that <a class="reference internal" href="API.html#striptease.StripConnection" title="striptease.StripConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">striptease.StripConnection</span></code></a> can be used as a context
manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">StripConnection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="c1"># Use &quot;conn&quot; freely here, as the login has already been done</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-commands-to-the-instrument">
<h2>Sending commands to the instrument<a class="headerlink" href="#sending-commands-to-the-instrument" title="Permalink to this headline">¶</a></h2>
<p>Once you have a working connection to the server, you can use the
method <a class="reference internal" href="API.html#striptease.StripConnection.slo_command" title="striptease.StripConnection.slo_command"><code class="xref py py-meth docutils literal notranslate"><span class="pre">striptease.StripConnection.slo_command()</span></code></a> to send «slow»
commands to the server. This kind of commands is the most common, and
you are going to use it 95% of the time. The following command
retrieves the drain voltage for HEMT #0 from detector <cite>R0</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vd0_hk</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">slo_command</span><span class="p">(</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
    <span class="n">board</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span>
    <span class="n">pol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;BIAS&quot;</span><span class="p">,</span>
    <span class="n">base_addr</span><span class="o">=</span><span class="s2">&quot;VD0_HK&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The example above retrieved a value from the electronic board and
saved it into <code class="docutils literal notranslate"><span class="pre">vd0_hk</span></code>. Changing the method from <code class="docutils literal notranslate"><span class="pre">GET</span></code> to <code class="docutils literal notranslate"><span class="pre">SET</span></code>
permits to set new values in the board; we are going to overwrite the
same parameter, thus with a null net effect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">slo_command</span><span class="p">(</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;SET&quot;</span><span class="p">,</span>
    <span class="n">board</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span>
    <span class="n">pol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;BIAS&quot;</span><span class="p">,</span>
    <span class="n">base_addr</span><span class="o">=</span><span class="s2">&quot;VD0_HK&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">vd0_hk</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-data-are-saved-and-accessed">
<h2>How data are saved and accessed<a class="headerlink" href="#how-data-are-saved-and-accessed" title="Permalink to this headline">¶</a></h2>
<p>The web server acquiring data from the instrument distinguishes
between «fast» and «slow» timestreams; the scientific output of each
polarimeter belongs to the first category, while housekeeping
parameters like currents, biases, and temperatures are slow
timestreams. This distinction is kept in Striptease, as it acts as a
middleware library between the user and the web server.</p>
<p>Scientific and housekeeping data are saved by the web server in HDF5
files; no more than 6 hours of data are saved in a file, for the fear
of data loss. When a HDF5 file is closed, the web server immediately
creates a new one and continues saving data in it. It is possible to
force the web server to close the current HDF5 file and to create a
new one; this can be useful before running a long test script, for
instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">round_all_files</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="tags">
<h2>Tags<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h2>
<p>In long tests, it is often useful to mark some events happening: for
instance, a time span where the state of the instrument is considered
«stable», or the moment when a polarimeter is being turned off.</p>
<p>The web server implement «tags» to mark specific events during a
test. A tag is defined by a start and an end, and it must therefore be
opened and closed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">tag_start</span><span class="p">(</span><span class="s2">&quot;MY_TAG&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;My comment&quot;</span><span class="p">)</span>

<span class="c1"># Do whatever you want, send your commands, etc.</span>

<span class="n">conn</span><span class="o">.</span><span class="n">tag_stop</span><span class="p">(</span><span class="s2">&quot;MY_TAG&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Another comment&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is mandatory that a tag be closed before another one is
started. Thus, the following code will make the web server complain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># THIS DOES NOT WORK!</span>
<span class="n">conn</span><span class="o">.</span><span class="n">tag_start</span><span class="p">(</span><span class="s2">&quot;OUTER_TAG&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">tag_start</span><span class="p">(</span><span class="s2">&quot;INNER_TAG&quot;</span><span class="p">)</span> <span class="c1"># Error! must first close &quot;OUTER_TAG&quot;</span>
<span class="n">conn</span><span class="o">.</span><span class="n">tag_stop</span><span class="p">(</span><span class="s2">&quot;INNER_TAG&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">tag_stop</span><span class="p">(</span><span class="s2">&quot;OUTER_TAG&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To ease the use of tags, Striptease implements the
<a class="reference internal" href="API.html#striptease.StripTag" title="striptease.StripTag"><code class="xref py py-class docutils literal notranslate"><span class="pre">striptease.StripTag</span></code></a> class, which acts as a context manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">StripTag</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MY_TAG&quot;</span><span class="p">,</span>
    <span class="n">start_comment</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">stop_comment</span><span class="o">=</span><span class="s2">&quot;End&quot;</span><span class="p">):</span>

    <span class="c1"># Do whatever you want, send your commands, etc.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The main purpose of tags is to ease the implementation of analysis
scripts. You can query tags using the method
<a class="reference internal" href="API.html#striptease.StripConnection.tag_query" title="striptease.StripConnection.tag_query"><code class="xref py py-meth docutils literal notranslate"><span class="pre">striptease.StripConnection.tag_query()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>

<span class="n">tags</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">tag_query</span><span class="p">(</span><span class="s2">&quot;MY_TAG&quot;</span><span class="p">,</span>
    <span class="n">start_mjd</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2019-12-20&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mjd</span><span class="p">,</span>
    <span class="n">end_mjd</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2019-12-30&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mjd</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cur_tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
    <span class="c1"># &quot;cur_tag&quot; is a dictionary</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cur_tag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-complex-automatic-scripts">
<h2>Running complex automatic scripts<a class="headerlink" href="#running-complex-automatic-scripts" title="Permalink to this headline">¶</a></h2>
<p>To create long and complex automatic scripts, Striptease require users
to run a two-step process:</p>
<ol class="arabic simple">
<li><p>A Python script builds the sequence of commands and save it into a
file;</p></li>
<li><p>The user runs the sequence of commands using a command-line or GUI
tool. Striptease provides the file <code class="docutils literal notranslate"><span class="pre">program_batch_runner.py</span></code> for
this purpose.</p></li>
</ol>
<p>This two-fold approach ensures reproducibility and allows the user to
inspect the test procedure before actually running it. As the commands
are sent through a web server that understands commands in JSON form,
the text file saved by Python scripts is actually a JSON file
containing an ordered list of dictionaries, each containing a command.</p>
<div class="section" id="how-to-create-test-procedures">
<h3>How to create test procedures<a class="headerlink" href="#how-to-create-test-procedures" title="Permalink to this headline">¶</a></h3>
<p>To create a new script that builds a sequence of JSON commands, the
easiest way is to create a new class derived from
<code class="xref py py-class docutils literal notranslate"><span class="pre">striptease.procedures.StripProcedure</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">striptease.procedures</span> <span class="kn">import</span> <span class="n">StripProcedure</span>

<span class="k">class</span> <span class="nc">MyProcedure</span><span class="p">(</span><span class="n">StripProcedure</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyProcedure</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_emitter</span>

        <span class="c1"># Run all your commands using &quot;conn&quot;: it works like a</span>
        <span class="c1"># StripConnection object, but it writes command to a JSON</span>
        <span class="c1"># buffer instead of sending them to the server</span>

 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
     <span class="n">proc</span> <span class="o">=</span> <span class="n">MyProcedure</span><span class="p">()</span>
     <span class="n">proc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">run</span></code> will output the JSON file to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Striptease</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#establising-a-connection-with-the-server">Establising a connection with the server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sending-commands-to-the-instrument">Sending commands to the instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-data-are-saved-and-accessed">How data are saved and accessed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tags">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-complex-automatic-scripts">Running complex automatic scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Developer’s manual</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="authentication.html" title="previous chapter">Authentication</a></li>
      <li>Next: <a href="API.html" title="next chapter">API documentation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018−2019, LSPE/STRIP team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/tutorial.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>